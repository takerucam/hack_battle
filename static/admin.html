<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>admin</title>
  </head>
  <body>
    <section class="section">
      <div class="container has-text-centered">
        <div class="columns">
          <div class="column">
            <button id="input" class="button is-primary">入力モード</button>
          </div>
          <div class="column">
            <button id="omikuji" class="button is-info">出力モード</button>
          </div>
          <div class="column">
            <button id="delete" class="button is-danger">データを全削除</button>
          </div>
        </div>
      </div>
    </section>
  </body>
  <script type="module">
    import { WebPush } from "./WebPush.js";

    let inuuid;
    window.onload = async () => {
      let uuid = WebPush.getID();
      if (uuid) {
        inuuid = uuid;
      }

      // console.log(uuid);
      // const current_mode = await fetch("/getmode");
      // if (current_mode == 0) {
      // }
      document.getElementById("input").disabled = true;
    };
    document.getElementById("input").onclick = function () {
      // const response = await fetch("/setmode?mode=input");
      document.getElementById("input").disabled = true;
      document.getElementById("omikuji").disabled = false;
    };
    document.getElementById("omikuji").onclick = async () => {
      // const response = await fetch("/setmode?mode=omikuji");
      document.getElementById("input").disabled = false;
      document.getElementById("omikuji").disabled = true;

      uuid = await WebPush.subscribe();
      console.log("uuid ", uuid);

      const data = {
        title: "WebPush test",
        body: "WebPush for Deno に関するブログです",
        url: "https://fukuno.jig.jp/4171",
        timeout: 5000, // 通知を消すまでの長さ msec （デフォルト0:消さない）
        delay: 1000, // 表示するまでの時間 msec（デフォルト0）
      };
      console.log(await WebPush.push(data));
    };

    document.getElementById("delete").onclick = function () {
      // const response = await fetch("/delete");
    };
  </script>
</html>
